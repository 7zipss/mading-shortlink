### 1. 核心维度的区别

| **特性**     | **过滤器风控 (UserFlowRiskControlFilter)**    | **Sentinel 限流 (@SentinelResource)**         |
| ------------ | --------------------------------------------- | --------------------------------------------- |
| **控制维度** | **用户维度 (User-Based)**                     | **资源/接口维度 (Resource-Based)**            |
| **核心逻辑** | "限制**某一个用户**在单位时间内只能访问 N 次" | "限制**整个接口**在单位时间内只能被调用 N 次" |
| **识别依据** | 用户名 (`UserContext.getUsername()`)          | 接口方法签名 / 资源名 (`create_short-link`)   |
| **典型场景** | 防止恶意用户/脚本刷接口（防刷单）             | 防止突发大流量冲垮系统（防雪崩）              |
| **所属模块** | `admin` (后台管理模块)                        | `project` (核心业务模块)                      |

- **过滤器风控**：它关心的是“**谁**在访问”。哪怕系统现在很空闲，如果张三在一秒钟内发了 100 次请求，他也会被封禁，因为这不像是正常人的行为。
- **Sentinel 限流**：它关心的是“**系统还能扛得住吗**”。哪怕是 100 个不同的用户，每人只发了 1 次请求，如果这 100 个请求同时涌入超过了系统的 QPS 阈值（比如配置的 QPS=1），Sentinel 就会开始拒绝，以保护数据库和 CPU 不被打爆。

------

### 2. 技术实现的区别

#### A. 过滤器风控 (DIY 方案)

- **技术栈**: Servlet Filter + Redis + Lua 脚本。
- **实现方式**: 手写代码。在请求到达 Controller 之前，在 Filter 层拦截。
- **算法策略**: **滑动窗口/冷却惩罚**。
  - 注意 `user_flow_risk_control.lua` 中的 `redis.call("EXPIRE", accessKey, timeWindow)`。
  - **特点**: 每次访问都会重置过期时间。这意味着如果用户持续违规高频访问，他的限制永远不会解除（Key 不过期），必须彻底停止访问一段时间才能“冷却”。
- **灵活性**: 高。你可以随意修改 Lua 脚本来实现各种奇葩的风控规则（比如 IP 黑名单、地域限制等）。

#### B. Sentinel 限流 (中间件方案)

- **技术栈**: Alibaba Sentinel 框架 + AOP。
- **实现方式**: 注解驱动。在 Controller 方法执行前后进行切面拦截。
- **算法策略**: **令牌桶 / 漏桶 / 滑动时间窗**。
  - Sentinel 内部实现了成熟的流控算法。配置 `RuleConstant.FLOW_GRADE_QPS` 后，它会平滑地计算 QPS。
  - **特点**: 更加智能和标准。它支持预热（Warm Up）、排队等待等高级策略，不仅仅是简单的计数。
- **灵活性**: 依赖框架能力。但可以通过控制台（Dashboard）动态调整规则，无需重启应用。

------

### 3. 返回结果的区别

- **过滤器风控**:
  - 直接在 Filter 中通过 `response.getWriter()` 返回 JSON。
  - 错误码：`ClientException(FLOW_LIMIT_ERROR)`。
  - 用户看到的提示通常是：“当前流量过大，请稍后再试”或“操作太频繁”。
- **Sentinel 限流**:
  - 抛出 `BlockException`，然后由 `CustomBlockHandler` 捕获并处理。
  - 错误码：`B100000`。
  - 提示信息：“当前访问网站人数过多，请稍后再试...”。

------

### 4. 总结：为什么需要两个？

这就好比去游乐园玩项目：

1. **过滤器风控（检票员）**：
   - 他盯着**每一个人**。
   - 如果发现**张三**想插队，或者刚玩完一次马上又想冲进去玩（违反了“每人每小时只能玩一次”的规定），检票员会把张三拦住。
   - **目的**：防止有人捣乱，维护公平。
2. **Sentinel 限流（大门闸机）**：
   - 它盯着**整个游乐设施**。
   - 不管来的是谁，只要设施里已经人满为患了（QPS > 阈值），闸机就会自动关闭，不再放任何人进来，直到里面的人出来。
   - **目的**：防止设施超载崩塌，保护系统安全。

**在你的系统中：**

- `UserFlowRiskControlFilter` 保护的是业务逻辑不受**恶意用户**攻击。
- `Sentinel` 保护的是系统资源（CPU/DB）不受**瞬时高并发**流量冲击。

两者结合，才能构成一个健壮的防护网。